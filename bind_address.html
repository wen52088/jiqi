
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>è®¾ç½®ç»‘å®šåœ°å€</title>
  <link rel="stylesheet" href="style_password.css" />
  
  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    Telegram.WebApp.ready?.();
    let userId = "test_user";
    try {
      userId = Telegram.WebApp.initDataUnsafe?.user?.id || "test_user";
    } catch (e) {}

    const passKey = `userPassword_${userId}`;
    const errorKey = `bindError_${userId}`;

    function validateTRC20(address) {
      return /^T[a-zA-Z0-9]{33}$/.test(address);
    }

    function handleSubmit() {
      const address = document.getElementById("address").value.trim();
      const password = document.getElementById("password").value.trim();

      const stored = sessionStorage.getItem(passKey);
      alert(`è°ƒè¯•ä¿¡æ¯ï¼šuserId = ${userId}\npassKey = ${passKey}\nstored = ${stored}`);

      if (!validateTRC20(address)) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ TRC20 åœ°å€");
        return;
      }
      if (!stored) {
        alert("âš ï¸ å½“å‰å°šæœªè®¾ç½®å®‰å…¨å¯†ç ï¼Œè¯·å…ˆå®Œæˆé¦–æ¬¡è®¾ç½®ã€‚");
        return;
      }
      if (password !== stored) {
        let err = parseInt(sessionStorage.getItem(errorKey) || "0") + 1;
        sessionStorage.setItem(errorKey, err);
        if (err >= 5) {
          alert("ğŸš« æ‚¨çš„è´¦æˆ·å·²ç»è¢«ç³»ç»Ÿé”å®šï¼Œè¯·è”ç³»å®¢æœäººå·¥å¤„ç†ã€‚");
        } else {
          alert(`ğŸš« æ‚¨çš„å®‰å…¨å¯†ç è¾“å…¥é”™è¯¯${err}æ¬¡ï¼Œé”™5æ¬¡å°†é”å®šã€‚`);
        }
        return;
      }
      sessionStorage.setItem(`withdrawAddress_${userId}`, address);
      window.location.replace("bind_address_success.html");
    }

    function focusShift(input) {
      input.value = input.value.replace(/[^0-9]/g, "").slice(0, 4);
    }
  </script>

  
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    Telegram.WebApp.ready?.();
    let userId = "test_user";
    try {
      userId = Telegram.WebApp.initDataUnsafe?.user?.id || "test_user";
    } catch (e) {}

    const passKey = `userPassword_${userId}`;
    const errorKey = `bindError_${userId}`;

    function validateTRC20(address) {
      return /^T[a-zA-Z0-9]{33}$/.test(address);
    }

    function handleSubmit() {
      const address = document.getElementById("address").value.trim();
      const password = document.getElementById("password").value.trim();

      const stored = sessionStorage.getItem(passKey);
      alert(`è°ƒè¯•ä¿¡æ¯ï¼šuserId = ${userId}\npassKey = ${passKey}\nstored = ${stored}`);

      if (!validateTRC20(address)) {
        alert("è¯·è¾“å…¥æœ‰æ•ˆçš„ TRC20 åœ°å€");
        return;
      }
      if (!stored) {
        alert("âš ï¸ å½“å‰å°šæœªè®¾ç½®å®‰å…¨å¯†ç ï¼Œè¯·å…ˆå®Œæˆé¦–æ¬¡è®¾ç½®ã€‚");
        return;
      }
      if (password !== stored) {
        let err = parseInt(sessionStorage.getItem(errorKey) || "0") + 1;
        sessionStorage.setItem(errorKey, err);
        if (err >= 5) {
          alert("ğŸš« æ‚¨çš„è´¦æˆ·å·²ç»è¢«ç³»ç»Ÿé”å®šï¼Œè¯·è”ç³»å®¢æœäººå·¥å¤„ç†ã€‚");
        } else {
          alert(`ğŸš« æ‚¨çš„å®‰å…¨å¯†ç è¾“å…¥é”™è¯¯${err}æ¬¡ï¼Œé”™5æ¬¡å°†é”å®šã€‚`);
        }
        return;
      }
      sessionStorage.setItem(`withdrawAddress_${userId}`, address);
      window.location.replace("bind_address_success.html");
    }

    function focusShift(input) {
      input.value = input.value.replace(/[^0-9]/g, "").slice(0, 4);
    }
  </script>


</head>
<body>
  <div class="container" style="margin-top: 40px;">
        <div class="title">è®¾ç½®ç»‘å®šåœ°å€</div>
    <div class="white-box">
      <label class="label">ğŸ”¸ç»‘å®šåœ°å€:</label>
      <input id="address" type="text" placeholder="è¯·è¾“å…¥USDT-TRC20åœ°å€" class="input" />
      <label class="label">ğŸ”¸æç°å¯†ç :</label>
      <input id="password" type="password" maxlength="4" oninput="focusShift(this)" placeholder="è¯·è¾“å…¥4ä½å®‰å…¨å¯†ç " class="input" />
    </div>
    <button class="button" onclick="handleSubmit()">ä¸‹ä¸€æ­¥</button>
  </div>
</body>
</html>
